@using Microsoft.AspNetCore.Http;
@{
    ViewData["Title"] = "GeneratePropertyTax";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var CreatedBy = Convert.ToInt32(Context.Session.GetInt32("UserId"));

}
<input type="hidden" value="@CreatedBy" id="hdnCreatedBy" />
<form class="form-horizontal" method="get">
    <div id="dvTop" class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0 text-dark"></h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a asp-action="Index">Payment</a></li>
                        <li class="breadcrumb-item active">Demand Payment</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

<div class="card card-info">
  @if (TempData["msg"] != null)
      {
       <div class="alert alert-success alert-dismissible">
       <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
       <h5><i class="icon fas fa-check"></i> Alert!</h5>
          <p>@TempData["msg"]</p>
       </div>
      }

   <div class="card-header">
        <h3 class="card-title">Search Tax Payer</h3>
   </div>

   <div class="card-body">
   <hr />

   <div class="row">
       <div class="input-group d-flex justify-content-center col-5">
            <label class="col-sm-4 col-form-label">CID No<span style="font-weight: bold; color: red;"></span></label>
            <input id="Cid" class="form-control col-6" />
       </div>
       <div class="input-group d-flex justify-content-center col-5">
            <label class="col-sm-4 col-form-label">TTIN<span style="font-weight: bold; color: red;"></span></label>
            <input id="Ttin" class="form-control col-6" />
       </div>
   </div>
   <hr />

   <div class="row">
        <div class="input-group d-flex justify-content-center col-5">
             <label class="col-sm-4 col-form-label">Plot No<span style="font-weight: bold; color: red;"></span></label>
             <input id="PlotNo" class="form-control col-6" />
        </div>
        <div class="input-group d-flex justify-content-center col-5">
             <label class="col-sm-4 col-form-label">Thram No<span style="font-weight: bold; color: red;"></span></label>
             <input id="ThramNo" class="form-control col-6" />
        </div>
        <div class="input-group-append col-2">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" value="Search" class="btn btn-primary" onclick="return SearchTaxPayer();" />
        </div>
   </div>
   </div>
</div>
</form>

<div class="card card-info" id="dvTaxPayerInfo" style="display: none;">
    <div class="card-header">
         <h3 class="card-title">Tax Payer Information</h3>
    </div>
    <div class="card-body">
        <div class="form-group row">
            <table id="tblTaxPayer" class="table table-bordered table-striped">
                <thead style="background-color:mediumaquamarine">
                    <tr>
                        <th>#</th>
                        @*<th>Plot No</th>
                        <th>Thram No</th>*@
                        <th>TTIN </th>
                        <th>Tax Payer Type </th>
                        <th>CID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Mobile No </th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tbl_body">
                </tbody>
            </table>
        </div>

    <div class="form-group row" id="dvTaxYear" style="display:none;">
         <label class="col-sm-2 col-form-label">Tax Year</label>
        <div class="col-sm-4">
             <input type="hidden" id="TaxYear" />
             <select id="TaxYearId" class="form-control select2" style="width: 100%;" value="0" onchange="GetDetails();">
             </select>

<input type="hidden" id="HDNTAXPAYERID" />
<input type="hidden" id="HDNLANDOWNERSHIPID" />

        </div>
    </div>
    </div>
</div>

<div class="card card-info" id="dvLandOwnership" style="display:none;">
    <div class="card-header">
        <h3 class="card-title">Ownership Details</h3>
    </div>
<div class="card-body">
     <div class="form-group row">
          <label class="col-sm-1 col-form-label">TTIN </label>
         <div class="col-sm-3">
              <input type="text" id="txtTTIN" class="form-control" readonly />
         </div>
          <label class="col-sm-1 col-form-label">CID </label>
         <div class="col-sm-3">
              <input type="text" id="txtCid" class="form-control" readonly />
         </div>
          <label class="col-sm-1 col-form-label">Name </label>
         <div class="col-sm-3">
              <input type="text" id="txtName" class="form-control" readonly />
         </div>
     </div>

<div class="form-group row">
          <table id="showownership" class="table table-bordered table-striped">
                <thead style="background-color:mediumaquamarine">
                    <tr>
                        <th>#</th>
                        <th>Select</th>
                        <th>Thram No </th>
                        <th>Plot No </th>
                        <th>Net Area/PLR </th>

                        <th>Land Tax Amount</th>
                        <th>Land Tax Penalty</th>
                        <th>UD Tax Amount</th>
                        <th>UD Tax Penalty</th>
                        <th>UHT Amount</th>
                        <th>UHT Penalty</th>
                        <th>Garbage Amount</th>
                        <th>Garbage Penalty</th>
                        <th>Street Light Amount</th>
                        <th>Street Light Penalty</th>
                        <th>last Tax Year </th>
                    </tr>
                </thead>
             <tbody id="tbl_body2">
             </tbody>
          </table>

     <div class="input-group-append col-2">
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <input type="button" value="Calculate" class="btn btn-success" onclick="return Calculate();" />
     </div>
</div>
</div>
</div>

<div class="card card-info" id="LOwnershiptbl" style="display:none;">
    <div class="card-header">
        <h3 class="card-title">Ownership Details</h3>
    </div>
    <div class="card-body">
        <div class="form-group row">
            <table id="tbl1_ownership" class="table table-bordered table-striped">
                <thead style="background-color:mediumaquamarine">
                    <tr>
                        <th>#</th>
                        <th>Select</th>
                        <th>Thram No</th>
                        <th>Plot No </th>
                        <th>Net Area/PLR </th>

                        <th>Land Tax Amount</th>
                        <th>Land Tax Penalty</th>
                        <th>UD Tax Amount</th>
                        <th>UD Tax Penalty</th>
                        <th>UHT Amount</th>
                        <th>UHT Penalty</th>
                        <th>Garbage Amount</th>
                        <th>Garbage Penalty</th>
                        <th>Street Light Amount</th>
                        <th>Street Light Penalty</th>
                        <th>last Tax Year </th>
                    </tr>
                </thead>
              <tbody id="tbl_body7">
              </tbody>
            </table>
        </div>
    </div>
</div>

<div class="form-group row">
    <table id="tblcalculate" class="table table-bordered table-striped" style="display:none">
        <thead style="background-color:mediumaquamarine">
            <tr>
                <th>Total Land Tax Amount</th>
                <th>Total Land Tax Penalty</th>
                <th>Total UHT Amount</th>
                <th>Total UHT Penalty</th>
                <th>Total UD Tax </th>
                <th>Total UD Tax Penalty</th>
                <th>Total Garbage Amount</th>
                <th>Total Garbage Penalty</th>
                <th>Total Street Light Amount</th>
                <th>Total Street Light Penalty</th>
                <th>Total Penalties</th>
                <th>Grand Total</th>
            </tr>
        </thead>
      <tbody id="tbl_calculate">
      </tbody>
            <tr>
                <td><label id="hdnTotalLandTax" class="col-form-label" readonly /></td>
                <td><label id="lblTotalLandPenalty" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalUHTax" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalUHPenalty" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalUDTax" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalUDPenalty" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalGarbageTax" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalGarbageTaxPenalty" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalStreetLightTax" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalStreetLightTaxPenalty" class="col-form-label" readonly /></td>
                <td><label id="hdnTotalPenalties" class="col-form-label" readonly /></td>
                <td><label id="hdnGrandTotal" class="col-form-label" readonly /></td>
            </tr>
    </table>
<input type="hidden" id="hdnShow" />
</div>

<div id="dvGenerateAll" style="display:none;" class="form-group row">
     <label class="col-sm-2 col-form-label"> </label>
    <div class="col-sm-4">
        <input type="button" value="Generate All" class="btn btn-primary" onclick="return GenerateAll();" />
    </div>
</div>

<script src="~/plugins/jquery/jquery.min.js"></script>

<script>

//***********************************************  SEARCH TAXPAYER DETAILS   *********************************************************************
 function SearchTaxPayer() {
 $('#dvTaxPayer').hide(1000);
 $('#dvLandOwnership').hide(1000);
 $('#tblLandOwnership').hide(1000);
 $('#dvDemand').hide(1000);
 $('#tblcalculate').hide(1000);
 $('#dvTaxDetail').hide(1000);
 $('#dvTaxYear').hide(1000);
     if ($("#Ttin").val() == "" && $("#Cid").val() == "" && $("#PlotNo").val() == "" && $("#ThramNo").val() == "")
                {
                    swal("Please fill atleaset one field to search.!");
                    $("#Cid").focus();
                    return false;
                }
     var Cid = ($('#Cid').val());
     var Ttin = ($('#Ttin').val());
     var PlotNo = ($('#PlotNo').val());
     var ThramNo = ($('#ThramNo').val());
     if (Cid == Cid || Ttin == Ttin || PlotNo == PlotNo || ThramNo == ThramNo) {

     $.ajax({
            type: "GET",
            url: '@Url.Action("FetchTaxPayerByCID", "PropertyTaxsGenerateAll")',
            data: {
                  Cid: Cid,
                  Ttin: Ttin,
                  PlotNo: PlotNo,
                  ThramNo: ThramNo
                    },
            success: function (data) {
                $('#tbl_body').empty();

                    if (data.length > 0) {
                       GetCalendarYear();
                       $.each(data, function (key, value) {
                       $('#tbl_body').append(
                       '<tr>'
                             + '<td>' + (key + 1) + '</td>'
                             //+ '<td>' + value.plotNo + '</td>'
                             //+ '<td>' + value.thramNo + '</td>'
                             + '<td>' + value.ttin + '</td>'
                             + '<td>' + value.taxPayerType + '</td>'
                             + '<td>' + value.cid + '</td>'
                             + '<td>' + value.fullName + '</td>'
                             + '<td>' + value.email + '</td>'
                             + '<td>' + value.mobileNo + '</td>'
                             + '<td><b><a style="cursor: pointer; color: forestgreen;" title="View details" onclick="return GetLandOwnershipDetail(' + value.taxPayerId + ',' + value.landOwnershipId + ');">Select</a></b></td>'
                             + '</tr>');
                       });
                  $('#dvTaxPayerInfo').show(1000);
                  $('html,body').animate({
                    scrollTop: $("#dvTaxPayerInfo").offset().top
                     }, 'slow');
                    }
                    else {
                          swal("No data found!!!");
                          $('#dvTaxPayerInfo').hide(1000);
                          }
                    },
                    error: function () {
                        alert('error');
                    }

                });
            }
            else {
                 $('#tbl_body').append(
                 '<tr><td colspan="4" style="color: red;">No record found!</td></tr>');
            }
    }

//*********************************************** DISPLAY LAND OWNERSHIP DETAILS   *********************************************************************

 function GetLandOwnershipDetail(TaxPayerId, landOwnershipId) {
        $('#HDNTAXPAYERID').val(TaxPayerId);
        $('#HDNLANDOWNERSHIPID').val(landOwnershipId);
        $('#tblcalculate').hide(1000);
        $('#dvTaxYear').show(1000);
        $('#tblLandOwnership').hide();
     $('#dvLandOwnership').hide(1000);
            }

    $("#btnCancel").click(function () {

        $("#dvTaxDetail").hide(1000);
        $("#dvLandOwnership").hide(1000);

    });

                function GenerateAll() {
                    var index = 0;
                    var myarray = [];
                    $('#tbl1_ownership > tbody  > tr ').each(function () {
                        var GenerateAll = {};

                        var LandTaxAmount = $('#slandAmount_' + parseInt(index)).val();
                        var LandTaxPenalty = $('#slandPenalty_' + parseInt(index)).val();
                        var UDTaxAmount = $('#sudtax_' + parseInt(index)).val();
                        var UDTaxPenalty = $('#sudPenalty_' + parseInt(index)).val();
                        var UTHAmount = $('#sUHTTax_' + parseInt(index)).val();
                        var UTHPenalty = $('#sUHTPenalty_' + parseInt(index)).val();
                        var GarbageAmount = $('#sGarbageAmount_' + parseInt(index)).val();
                        var GarbagePenalty = $('#sGarbagePenalty_' + parseInt(index)).val();
                        var StreetLightAmount = $('#sStreetLightTax_' + parseInt(index)).val();
                        var StreetLightPenalty = $('#sStreetLightPenalty_' + parseInt(index)).val();
                        var PType = $('#stax_' + parseInt(index)).val();
                        var RowTotal = $('#srowtotal_' + parseInt(index)).val();
                        var LandDetailId = $('#slandDetailId_' + parseInt(index)).val();
                        var LandOwnershipId = $('#slandOwnershipId_' + parseInt(index)).val();
                        var LandOwnershipTypeId = $('#slandOwnershipTypeId_' + parseInt(index)).val();
                        var TaxPayerId = $('#staxPayerId_' + parseInt(index)).val();
                        var ConstructionTypeId = $('#sconstructionTypeId_' + parseInt(index)).val();
                        var BuildingUnitClassId = $('#sbuildingUnitClassId_' + parseInt(index)).val();
                        var BuildingUnituseTypeId = $('#sbuildingUnitUseTypeId_' + parseInt(index)).val();
                        var LandTaxId = $('#slandTaxId_' + parseInt(index)).val();
                        var LandTaxRate = $('#slandTaxRate_' + parseInt(index)).val();
                        var UDTaxId = $('#sudtaxId_' + parseInt(index)).val();
                        var UDTaxApplicable = $('#sudtaxApplicable_' + parseInt(index)).val();
                        var UDTaxRate = $('#sudtaxRate_' + parseInt(index)).val();
                        var PenaltyOrRate = $('#spenaltyOrRate_' + parseInt(index)).val();
                        var UnitTaxId = $('#sunitTaxId_' + parseInt(index)).val();
                        var GarbageTaxId = $('#sgarbageTaxId_' + parseInt(index)).val();
                        var StreetLightTaxId = $('#sstreetLightTaxId_' + parseInt(index)).val();
                        var TaxPayerName = $('#staxPayerName_' + parseInt(index)).val();
                        var PLR = $('#splr_' + parseInt(index)).val();
                        var TTIN = $('#sttin_' + parseInt(index)).val();
                        var CID = $('#scid_' + parseInt(index)).val();
                        var PlotNo = $('#splotNo_' + parseInt(index)).val();
                        var ThramNo = $('#sthramNo_' + parseInt(index)).val();
                        var PenaltyDays = $('#spenaltyDays_' + parseInt(index)).val();
                        var BuildingNo = $('#sbuildingNo_' + parseInt(index)).val();
                        var OccupancyCertificateNo = $('#soccupancyCertificateNo_' + parseInt(index)).val();
                        var OccupancyCertificateDate = $('#soccupancyCertificateDate_' + parseInt(index)).val();
                        var ConstructionType = $('#sconstructionType_' + parseInt(index)).val();
                        var BuildingUnitUseType = $('#sbuildingUnitUseType_' + parseInt(index)).val();
                        var BuildingUnitClassName = $('#sbuildingUnitClassName_' + parseInt(index)).val();
                        var NoOfUnits = $('#snoOfUnit_' + parseInt(index)).val();
                        var UHTRate = $('#sUHTRate_' + parseInt(index)).val();
                        var GarbageRate = $('#sGarbageRate_' + parseInt(index)).val();
                        var StreetLightRate = $('#sStreetLightRate_' + parseInt(index)).val();


                        GenerateAll.LandTaxAmount = parseFloat(LandTaxAmount);
                        GenerateAll.LandTaxPenalty = parseFloat(LandTaxPenalty);
                        GenerateAll.UDTaxAmount = parseFloat(UDTaxAmount);
                        GenerateAll.UDTaxPenalty = parseFloat(UDTaxPenalty);
                        GenerateAll.UTHAmount = parseFloat(UTHAmount);
                        GenerateAll.UTHPenalty = parseFloat(UTHPenalty);
                        GenerateAll.GarbageAmount = parseFloat(GarbageAmount);
                        GenerateAll.GarbagePenalty = parseFloat(GarbagePenalty);
                        GenerateAll.StreetLightAmount = parseFloat(StreetLightAmount);
                        GenerateAll.StreetLightPenalty = parseFloat(StreetLightPenalty);
                        GenerateAll.LandDetailId = parseInt(LandDetailId);
                        GenerateAll.LandOwnershipId = parseInt(LandOwnershipId);
                        GenerateAll.LandOwnershipTypeId = parseInt(LandOwnershipTypeId);
                        GenerateAll.TaxPayerId = parseInt(TaxPayerId);
                        GenerateAll.ConstructionTypeId = parseInt(ConstructionTypeId);
                        GenerateAll.BuildingUnitClassId = parseInt(BuildingUnitClassId);
                        GenerateAll.BuildingUnituseTypeId = parseInt(BuildingUnituseTypeId);
                        GenerateAll.LandTaxId = parseInt(LandTaxId);
                        GenerateAll.LandTaxRate = parseFloat(LandTaxRate);
                        GenerateAll.UDTaxId = parseInt(UDTaxId);
                        GenerateAll.UDTaxApplicable = UDTaxApplicable;
                        GenerateAll.UDTaxRate = parseFloat(UDTaxRate);
                        GenerateAll.PenaltyOrRate = parseFloat(PenaltyOrRate);
                        GenerateAll.UnitTaxId = parseInt(UnitTaxId);
                        GenerateAll.GarbageTaxId = parseInt(GarbageTaxId);
                        GenerateAll.StreetLightTaxId = parseInt(StreetLightTaxId);
                        GenerateAll.TaxPayerName = TaxPayerName;
                        GenerateAll.PLR = parseFloat(PLR);
                        GenerateAll.TTIN = TTIN;
                        GenerateAll.CID = CID;
                        GenerateAll.PlotNo = PlotNo;
                        GenerateAll.ThramNo = ThramNo;
                        GenerateAll.PenaltyDays = parseInt(PenaltyDays);
                        GenerateAll.BuildingNo = BuildingNo;
                        GenerateAll.OccupancyCertificateNo = OccupancyCertificateNo;
                        GenerateAll.OccupancyCertificateDate = OccupancyCertificateDate;
                        GenerateAll.ConstructionType = ConstructionType;
                        GenerateAll.BuildingUnitUseType = BuildingUnitUseType;
                        GenerateAll.BuildingUnitClassName = BuildingUnitClassName;
                        GenerateAll.NoOfUnits = parseInt(NoOfUnits);
                        GenerateAll.UHTRate = parseFloat(UHTRate);
                        GenerateAll.GarbageRate = parseFloat(GarbageRate);
                        GenerateAll.StreetLightRate = parseFloat(StreetLightRate);
                        GenerateAll.TotalAmount = parseFloat(RowTotal);
                        GenerateAll.PType = parseInt(PType);
                        GenerateAll.CalendarYearId = parseInt($("#TaxYearId").val());
                        GenerateAll.CalendarYear = $('#TaxYearId option:selected').text();
                        GenerateAll.Amount = parseFloat($('#hdnShow').val());
                        GenerateAll.CreatedBy = parseInt($("#hdnCreatedBy").val());;
                        myarray.push(GenerateAll);
                        index = index + 1
                    });

                    var json_data = JSON.stringify(myarray);
                    console.log(json_data);
                    $.ajax({
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: '@Url.Action("GenerateLandTax", "PropertyTaxsGenerateAll")',
                        type: "POST",
                        data: json_data,
                        success: function (response) {
                            if (response.length > 0) {

                                swal(response);
                                    $('#img').hide();
                                }
                                else {
                                    swal('Demand generation Failed!');
                                    $('#img').hide();
                                    return false;
                                }

                            }

                            });
                }

function GetCalendarYear() {
            $.ajax({
                type: "Get",
                url: '@Url.Action("PopulateCalendarYear", "PropertyTaxsGenerateAll")',
                data: {
                },
                success: function (data) {
                    console.log(data);
                    $('#TaxYearId').empty();
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].value + '>'
                                + data[i].text
                                + '</option>');
                            $('#TaxYearId').append(newOption);
                        }
                        $('#img').hide();
                    }
                },
                error: function () {
                    alert('Error occured while loading year');
                }
            });
        }

function GetDetails() {
        $('#dvTaxYear').show(1000);
        $('html,body').animate({
            scrollTop: $("#dvTaxYear").offset().top
        }, 'slow');

            $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetOwnershipDetailByTaxPayerId", "PropertyTaxsGenerateAll")',
                    data: {
                        LandOwnershipId: $('#HDNLANDOWNERSHIPID').val(),
                        TaxYearId: $('#TaxYearId').val()

                        },
                        success: function (data) {
                            console.log(data);
                            $('#dvLandOwnership').show(1000);
                            $('#tbl_body2').empty();
                            if (data.length > 0) {
                                $("#txtTTIN").val(data[0].ttin);
                                $('#tblLandOwnership').show(1000);
                                $("#txtCid").val(data[0].cid);
                                $("#txtName").val(data[0].taxPayerName);

                                $.each(data, function (key, value) {
                                    $('#tbl_body2').append(
                                        '<tr>' + '<td>' + (key + 1) + '</td>'
                                        + '<td><input id="chk1_' + key + '" type="checkbox" value="' + value.landOwnershipId + '" class"=checkbox" /> <label for=chk1_' + key + '></label>'
                                        + '</td>'
                                        + '<td>' + value.thramNo + '</td>'
                                        + '<td>' + value.plotNo + '</td>'
                                        + '<td>' + value.plr + '</td>'
                                        + '<td id="landTaxAmount_' + key + '">' + value.landTaxAmount.toFixed(2) + '</td>'
                                        + '<td id="landTaxPenalty_' + key + '">' + value.landTaxPenalty.toFixed(2) + '</td>'
                                        + '<td id="udTaxAmount_' + key + '">' + value.udTax.toFixed(2) + '</td>'
                                        + '<td id="udTaxPenalty_' + key + '">' + value.udTaxPenalty.toFixed(2) + '</td>'
                                        + '<td id="uhtAmount_' + key + '">' + value.uhtAmount.toFixed(2) + '</td>'
                                        + '<td id="uhtPenalty_' + key + '">' + value.uhtPenalty.toFixed(2) + '</td>'
                                        + '<td id="garbageAmount_' + key + '">' + value.garbageAmount.toFixed(2) + '</td>'
                                        + '<td id="garbagePenalty_' + key + '">' + value.garbagePenalty.toFixed(2) + '</td>'
                                        + '<td id="streetLightAmount_' + key + '">' + value.streetLightAmount.toFixed(2) + '</td>'
                                        + '<td id="streetLightPenalty_' + key + '">' + value.streetLightPenalty.toFixed(2) + '</td>'
                                        + '<td>' + value.lastTaxPaidYear + '</td>'

                                        + '</td>'
                                        + '</tr>');
                                });
                                $('#img').hide();
                            }
                            else {
                                $('#img').hide();
                                $('#tbl_body2').append(
                                    '<tr><td colspan="7" style="color: red;">No record found!</td></tr>');
                            }

                        },
                            error: function () {
                            $('#img').hide();
                            alert('Error occured');
                            }
            });
        }

    function Calculate() {
        var selected = new Array();
        var ids;
        $("#showownership input[type=checkbox]:checked").each(function () {
            selected.push(this.value);
        });
        if (selected.length > 0) {
                        ids = selected.join(",");
                    }
                    else {
                        swal('Please Select a Row.!');
                        $('#img').hide();
                        return false;
        }

        var i = 0;

        var LandTaxAmt = 0.00;
        var LandTaxPenalty = 0.00;
        var UDAmt = 0.00;
        var UDPenalty = 0.00;
        var UHTAmt = 0.00;
        var UHTPenalty = 0.00;
        var GarbageTaxAmt = 0.00;
        var GarbageTaxPenalty = 0.00;
        var StreetLightTaxAmt = 0.00;
        var StreetLightTaxPenalty = 0.00;

       $.ajax({
          type: "GET",
          url: '@Url.Action("GetOwnershipDetailByLandOwnershipId", "PropertyTaxsGenerateAll")',
           data: {
              Ids: "'"+ ids+"'",
              TaxYearId: $('#TaxYearId').val()

          },
           success: function (data) {
              console.log(data);
              $('#tbl_body7').empty();
              if (data.length > 0) {
                  $("#txtTTIN").val(data[0].ttin);
                  $("#txtCid").val(data[0].cid);
                  $("#txtName").val(data[0].taxPayerName);

                  $.each(data, function (key, value) {
                      var total = value.landTaxAmount + value.landTaxPenalty + value.udTax + value.udTaxPenalty + value.uhtAmount + value.uhtPenalty + value.garbageAmount + value.garbagePenalty + value.streetLightAmount + value.streetLightPenalty;
                      $('#tbl_body7').append(
                          '<tr>' + '<td>' + (key + 1) + '</td>'
                          + '<td><input id="chk_' + key + '" type="checkbox" value="' + value.landOwnershipId + '" checked /> <label for=chk_' + key + '></label>'
                          + '</td>'
                          + '<td>' + value.thramNo + '</td>'
                          + '<td>' + value.plotNo + '</td>'
                          + '<td>' + value.plr + '</td>'
                          + '<td id="slandTaxAmount_' + key + '">' + value.landTaxAmount.toFixed(2) + '</td>'
                          + '<td id="slandTaxPenalty_' + key + '">' + value.landTaxPenalty.toFixed(2) + '</td>'
                          + '<td id="sudTaxAmount_' + key + '">' + value.udTax.toFixed(2) + '</td>'
                          + '<td id="sudTaxPenalty_' + key + '">' + value.udTaxPenalty.toFixed(2) + '</td>'
                          + '<td id="suhtAmount_' + key + '">' + value.uhtAmount.toFixed(2) + '</td>'
                          + '<td id="suhtPenalty_' + key + '">' + value.uhtPenalty.toFixed(2) + '</td>'
                          + '<td id="sgarbageAmount_' + key + '">' + value.garbageAmount.toFixed(2) + '</td>'
                          + '<td id="sgarbagePenalty_' + key + '">' + value.garbagePenalty.toFixed(2) + '</td>'
                          + '<td id="sstreetLightAmount_' + key + '">' + value.streetLightAmount.toFixed(2) + '</td>'
                          + '<td id="sstreetLightPenalty_' + key + '">' + value.streetLightPenalty.toFixed(2) + '</td>'
                          + '<td>' + value.lastTaxPaidYear + '</td>'
                          + '<td><input id="stax_' + key + '" type="hidden" value="' + value.tax + '" /></td>'
                          + '<td><input id="slandAmount_' + key + '" type="hidden" value="' + value.landTaxAmount.toFixed(2) + '" /></td>'
                          + '<td><input id="slandPenalty_' + key + '" type="hidden" value="' + value.landTaxPenalty.toFixed(2) + '" /></td>'
                          + '<td><input id="srowtotal_' + key + '" type="hidden" value="' + total.toFixed(2) + '" /></td>'
                          + '<td><input id="slandOwnershipId_' + key + '" type="hidden" value="' + value.landOwnershipId + '" /></td>'
                          + '<td><input id="slandDetailId_' + key + '" type="hidden" value="' + value.landDetailId + '" /></td>'
                          + '<td><input id="slandOwnershipTypeId_' + key + '" type="hidden" value="' + value.landOwnershipTypeId + '" /></td>'
                          + '<td><input id="staxPayerId_' + key + '" type="hidden" value="' + value.taxPayerId + '" /></td>'
                          + '<td><input id="sconstructionTypeId_' + key + '" type="hidden" value="' + value.constructionTypeId + '" /></td>'
                          + '<td><input id="sbuildingUnitClassId_' + key + '" type="hidden" value="' + value.buildingUnitClassId + '" /></td>'
                          + '<td><input id="sbuildingUnitUseTypeId_' + key + '" type="hidden" value="' + value.buildingUnitUseTypeId + '" /></td>'
                          + '<td><input id="slandTaxId_' + key + '" type="hidden" value="' + value.landTaxId + '" /></td>'
                          + '<td><input id="slandTaxRate_' + key + '" type="hidden" value="' + value.landTaxRate + '" /></td>'
                          + '<td><input id="sudtaxId_' + key + '" type="hidden" value="' + value.udTaxId + '" /></td>'
                          + '<td><input id="sudtax_' + key + '" type="hidden" value="' + value.udTax.toFixed(2) + '" /></td>'
                          + '<td><input id="sudPenalty_' + key + '" type="hidden" value="' + value.udTaxPenalty.toFixed(2) + '" /></td>'
                          + '<td><input id="sudtaxApplicable_' + key + '" type="hidden" value="' + value.udTaxApplicable + '" /></td>'
                          + '<td><input id="sudtaxRate_' + key + '" type="hidden" value="' + value.udTaxRate + '" /></td>'
                          + '<td><input id="spenaltyOrRate_' + key + '" type="hidden" value="' + value.penaltyOrRate + '" /></td>'
                          + '<td><input id="sunitTaxId_' + key + '" type="hidden" value="' + value.unitTaxId + '" /></td>'
                          + '<td><input id="sgarbageTaxId_' + key + '" type="hidden" value="' + value.garbageTaxId + '" /></td>'
                          + '<td><input id="sstreetLightTaxId_' + key + '" type="hidden" value="' + value.streetLightTaxId + '" /></td>'
                          + '<td><input id="staxPayerName_' + key + '" type="hidden" value="' + value.taxPayerName + '" /></td>'
                          + '<td><input id="splr_' + key + '" type="hidden" value="' + value.plr + '" /></td>'
                          + '<td><input id="sttin_' + key + '" type="hidden" value="' + value.ttin + '" /></td>'
                          + '<td><input id="scid_' + key + '" type="hidden" value="' + value.cid + '" /></td>'
                          + '<td><input id="splotNo_' + key + '" type="hidden" value="' + value.plotNo + '" /></td>'
                          + '<td><input id="sthramNo_' + key + '" type="hidden" value="' + value.thramNo + '" /></td>'
                          + '<td><input id="spenaltyDays_' + key + '" type="hidden" value="' + value.penaltydays + '" /></td>'
                          + '<td><input id="sbuildingNo_' + key + '" type="hidden" value="' + value.buildingNo + '" /></td>'
                          + '<td><input id="soccupancyCertificateNo_' + key + '" type="hidden" value="' + value.occupancyCertificateNo + '" /></td>'
                          + '<td><input id="soccupancyCertificateDate_' + key + '" type="hidden" value="' + value.occupancyCertificateDate + '" /></td>'
                          + '<td><input id="sconstructionType_' + key + '" type="hidden" value="' + value.constructionType + '" /></td>'
                          + '<td><input id="sbuildingUnitUseType_' + key + '" type="hidden" value="' + value.buildingUnitUseType + '" /></td>'
                          + '<td><input id="sbuildingUnitClassName_' + key + '" type="hidden" value="' + value.buildingUnitClassName + '" /></td>'
                          + '<td><input id="snoOfUnit_' + key + '" type="hidden" value="' + value.noOfUnit + '" /></td>'
                          + '<td><input id="sUHTRate_' + key + '" type="hidden" value="' + value.uhtRate + '" /></td>'
                          + '<td><input id="sUHTTax_' + key + '" type="hidden" value="' + value.uhtAmount.toFixed(2) + '" /></td>'
                          + '<td><input id="sUHTPenalty_' + key + '" type="hidden" value="' + value.uhtPenalty + '" /></td>'
                          + '<td><input id="sGarbageRate_' + key + '" type="hidden" value="' + value.garbageRate + '" /></td>'
                          + '<td><input id="sGarbageAmount_' + key + '" type="hidden" value="' + value.garbageAmount.toFixed(2) + '" /></td>'
                          + '<td><input id="sGarbagePenalty_' + key + '" type="hidden" value="' + value.garbagePenalty.toFixed(2) + '" /></td>'
                          + '<td><input id="sStreetLightRate_' + key + '" type="hidden" value="' + value.streetLightRate + '" /></td>'
                          + '<td><input id="sStreetLightTax_' + key + '" type="hidden" value="' + value.streetLightAmount + '" /></td>'
                          + '<td><input id="sStreetLightPenalty_' + key + '" type="hidden" value="' + value.streetLightPenalty + '" /></td>'
                          + '</tr>');

                  });

                  $('#img').hide();

                  $('#tblcalculate').show(1000);

                  $("#dvLandOwnership TBODY TR").each(function () {
                      var ischked = $('#chk1_' + i).is(":checked");
                      if (ischked == true) {
                          $('#dvGenerateAll').show(1000);

                          $('#tbl_calculate').show(1000);
                          var row = $(this);

                          LandTaxAmt += parseFloat(row.find("TD").eq(5).html());
                          $('#hdnTotalLandTax').html(LandTaxAmt.toFixed(2));
                          LandTaxPenalty += parseFloat(row.find("TD").eq(6).html());
                          $('#lblTotalLandPenalty').html(LandTaxPenalty.toFixed(2));

                          UDAmt += parseFloat(row.find("TD").eq(7).html());
                          $('#hdnTotalUDTax').html(UDAmt.toFixed(2));
                          UDPenalty += parseFloat(row.find("TD").eq(8).html());
                          $('#hdnTotalUDPenalty').html(UDPenalty.toFixed(2));

                          UHTAmt += parseFloat(row.find("TD").eq(9).html());
                          $('#hdnTotalUHTax').html(UHTAmt.toFixed(2));
                          UHTPenalty += parseFloat(row.find("TD").eq(10).html());
                          $('#hdnTotalUHPenalty').html(UHTPenalty.toFixed(2));

                          StreetLightTaxAmt += parseFloat(row.find("TD").eq(13).html());
                          $('#hdnTotalStreetLightTax').html(StreetLightTaxAmt.toFixed(2));

                          StreetLightTaxPenalty += parseFloat(row.find("TD").eq(14).html());
                          $('#hdnTotalStreetLightTaxPenalty').html(StreetLightTaxPenalty.toFixed(2));

                          GarbageTaxAmt += parseFloat(row.find("TD").eq(11).html());
                          $('#hdnTotalGarbageTax').html(GarbageTaxAmt.toFixed(2));

                          GarbageTaxPenalty += parseFloat(row.find("TD").eq(12).html());
                          $('#hdnTotalGarbageTaxPenalty').html(GarbageTaxPenalty.toFixed(2));

                          $('#hdnTotalPenalties').html((LandTaxPenalty + UHTPenalty + StreetLightTaxPenalty + GarbageTaxPenalty + UDPenalty).toFixed(2));
                          $('#hdnGrandTotal').html((LandTaxAmt + GarbageTaxAmt + StreetLightTaxAmt + UHTAmt + LandTaxPenalty + UHTPenalty + StreetLightTaxPenalty + GarbageTaxPenalty + UDAmt + UDAmt).toFixed(2));
                          $('#hdnShow').val((LandTaxAmt + GarbageTaxAmt + StreetLightTaxAmt + UHTAmt + LandTaxPenalty + UHTPenalty + StreetLightTaxPenalty + GarbageTaxPenalty + UDAmt + UDAmt).toFixed(2));
                      }

                      i++;

                  });
              }
              else {
                  $('#img').hide();
                  $('#tbl_body7').append(
                      '<tr><td colspan="7" style="color: red;">No record found!</td></tr>');
              }

          },
          error: function () {
              $('#img').hide();
              alert('Error occured');
          }
      });
                }
</script>
