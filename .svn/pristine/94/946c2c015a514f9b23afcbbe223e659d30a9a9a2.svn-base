/*
Deployment script for tt_db

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "tt_db"
:setvar DefaultFilePrefix "tt_db"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__build__17635F73]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__build__17635F73];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__floor__185783AC]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__floor__185783AC];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__build__194BA7E5]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__build__194BA7E5];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__flatN__1C281490]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__flatN__1C281490];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__floor__1B33F057]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__floor__1B33F057];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__noOfU__1D1C38C9]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__noOfU__1D1C38C9];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__floor__1E105D02]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__floor__1E105D02];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__noOfr__1F04813B]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__noOfr__1F04813B];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__taxPa__1FF8A574]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__taxPa__1FF8A574];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__unitO__20ECC9AD]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__unitO__20ECC9AD];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__isMai__21E0EDE6]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__isMai__21E0EDE6];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__creat__22D5121F]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__creat__22D5121F];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__creat__23C93658]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__creat__23C93658];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__modif__24BD5A91]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__modif__24BD5A91];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__modif__25B17ECA]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__modif__25B17ECA];


GO
PRINT N'Dropping [dbo].[DF__tmp_ms_xx__trans__26A5A303]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [DF__tmp_ms_xx__trans__26A5A303];


GO
PRINT N'Dropping [dbo].[FK_mstBuildingUnitDetail_ToTable]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [FK_mstBuildingUnitDetail_ToTable];


GO
PRINT N'Dropping [dbo].[FK_mstBuildingUnitDetail_ToTable_1]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_1];


GO
PRINT N'Dropping [dbo].[FK_mstBuildingUnitDetail_ToTable_2]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_2];


GO
PRINT N'Dropping [dbo].[FK_mstBuildingUnitDetail_ToTable_3]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_3];


GO
PRINT N'Dropping [dbo].[FK_mstBuildingUnitDetail_ToTable_4]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] DROP CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_4];


GO
PRINT N'Starting rebuilding table [dbo].[mstBuildingUnitDetail]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_mstBuildingUnitDetail] (
    [buildingUnitDetailId]  INT             IDENTITY (1, 1) NOT NULL,
    [buildingDetailId]      INT             NOT NULL,
    [buildingUnitClassId]   INT             DEFAULT NULL NOT NULL,
    [floorNameId]           INT             DEFAULT NULL NOT NULL,
    [buildingUnitUseTypeId] INT             DEFAULT NULL NOT NULL,
    [isRegularized]         BIT             NOT NULL,
    [floorNo]               VARCHAR (45)    DEFAULT NULL NOT NULL,
    [flatNo]                VARCHAR (50)    DEFAULT NULL NOT NULL,
    [noOfUnit]              INT             DEFAULT '1' NULL,
    [floorArea]             DECIMAL (10, 2) DEFAULT NULL NOT NULL,
    [noOfrooms]             INT             DEFAULT NULL NOT NULL,
    [taxPayerId]            INT             DEFAULT NULL NULL,
    [landDetailId]          INT             DEFAULT 7 NOT NULL,
    [unitOwnerTypeId]       INT             DEFAULT NULL NOT NULL,
    [isMainOwner]           BIT             DEFAULT NULL NOT NULL,
    [createdBy]             INT             DEFAULT NULL NULL,
    [createdOn]             DATE            DEFAULT NULL NULL,
    [modifiedBy]            INT             DEFAULT NULL NULL,
    [modifiedOn]            DATE            DEFAULT NULL NULL,
    [transferStatusId]      TINYINT         DEFAULT NULL NULL,
    PRIMARY KEY CLUSTERED ([buildingUnitDetailId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[mstBuildingUnitDetail])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_mstBuildingUnitDetail] ON;
        INSERT INTO [dbo].[tmp_ms_xx_mstBuildingUnitDetail] ([buildingUnitDetailId], [buildingDetailId], [buildingUnitClassId], [floorNameId], [buildingUnitUseTypeId], [isRegularized], [flatNo], [floorNo], [noOfUnit], [floorArea], [noOfrooms], [taxPayerId], [unitOwnerTypeId], [isMainOwner], [createdBy], [createdOn], [modifiedBy], [modifiedOn], [transferStatusId])
        SELECT   [buildingUnitDetailId],
                 [buildingDetailId],
                 [buildingUnitClassId],
                 [floorNameId],
                 [buildingUnitUseTypeId],
                 [isRegularized],
                 [flatNo],
                 [floorNo],
                 [noOfUnit],
                 [floorArea],
                 [noOfrooms],
                 [taxPayerId],
                 [unitOwnerTypeId],
                 [isMainOwner],
                 [createdBy],
                 [createdOn],
                 [modifiedBy],
                 [modifiedOn],
                 [transferStatusId]
        FROM     [dbo].[mstBuildingUnitDetail]
        ORDER BY [buildingUnitDetailId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_mstBuildingUnitDetail] OFF;
    END

DROP TABLE [dbo].[mstBuildingUnitDetail];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_mstBuildingUnitDetail]', N'mstBuildingUnitDetail';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[FK_mstBuildingUnitDetail_ToTable]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_mstBuildingUnitDetail_ToTable] FOREIGN KEY ([buildingDetailId]) REFERENCES [dbo].[mstBuildingDetail] ([buildingDetailId]);


GO
PRINT N'Creating [dbo].[FK_mstBuildingUnitDetail_ToTable_1]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_1] FOREIGN KEY ([buildingUnitUseTypeId]) REFERENCES [dbo].[mstBuildingUnitUseType] ([buildingUnitUseTypeId]);


GO
PRINT N'Creating [dbo].[FK_mstBuildingUnitDetail_ToTable_2]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_2] FOREIGN KEY ([floorNameId]) REFERENCES [dbo].[mstFloorName] ([floorNameId]);


GO
PRINT N'Creating [dbo].[FK_mstBuildingUnitDetail_ToTable_3]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_3] FOREIGN KEY ([buildingUnitClassId]) REFERENCES [dbo].[mstBuildingUnitClass] ([buildingUnitClassId]);


GO
PRINT N'Creating [dbo].[FK_mstBuildingUnitDetail_ToTable_4]...';


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_4] FOREIGN KEY ([unitOwnerTypeId]) REFERENCES [dbo].[enumUnitOwnerType] ([unitOwnerTypeId]);


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH CHECK CHECK CONSTRAINT [FK_mstBuildingUnitDetail_ToTable];

ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH CHECK CHECK CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_1];

ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH CHECK CHECK CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_2];

ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH CHECK CHECK CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_3];

ALTER TABLE [dbo].[mstBuildingUnitDetail] WITH CHECK CHECK CONSTRAINT [FK_mstBuildingUnitDetail_ToTable_4];


GO
PRINT N'Update complete.';


GO
