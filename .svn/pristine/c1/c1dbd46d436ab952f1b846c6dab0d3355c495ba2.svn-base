@model List<CORE_BOL.FullPropertyTransferModel>
@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark"></h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-action="Index">Land Transaction</a></li>
                    <li class="breadcrumb-item active">Full Property Transfer</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<form class="form-horizontal" method="get">
    <div class="card card-info">
        @if (TempData["msg"] != null)
        {
            <div class="alert alert-danger alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                <h5><i class="icon fas fa-ban"></i> Alert!</h5>
                <p>@TempData["msg"]</p>
            </div>
        }
        <div class="card-header">
            <h3 class="card-title">Fetch Details From eSakor</h3>
        </div>
        <div class="card-body">
            <div class="input-group d-flex justify-content-center">
                <label class="col-sm-2 col-form-label">Transaction ID<span style="font-weight: bold; color: red;">*</span></label>
                <input id="Transactioninput" class="form-control col-sm-4"  value="14180737"/>
                <div class="input-group-append">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="button" value="Fetch" class="btn btn-primary" onclick="return fetchPropertyDetails();" id="btnFetchTransaction" />
                </div>
            </div>
        </div>
    </div>
</form>

<!--Tab Links-->
<div class="row" id="FPT_details" style="display:none;">
    <input type="hidden" id="hdnTransactionId" />
    <div class="col-md-12">
        <div class="card card-tabs">
            <div class="card-header p-0 pt-1" style="background-color:#17A2B8;">
                <ul class="nav nav-tabs" id="custom-tabs-five-tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="tbProperty_Details" data-toggle="pill" href="#property_Details" role="tab" aria-controls="Property_Details" aria-selected="true" style="color:black;">Property Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tbtransferor" data-toggle="pill" href="#Transferor" role="tab" aria-controls="transferor" aria-selected="false" style="color:black;">Transferor</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tbTransferee" data-toggle="pill" href="#transferee" role="tab" aria-controls="Transferee" aria-selected="false" style="color:black;">Transferee</a>
                    </li>
                    @*<li class="nav-item">
                        <a class="nav-link" id="tbOtherDetails" data-toggle="pill" href="#Other_Details" role="tab" aria-controls="OtherDetails" aria-selected="false" style="color:black;">Other Details</a>
                    </li>*@
                    <li class="nav-item">
                        <a class="nav-link" id="tbtaxDetails" data-toggle="pill" href="#Tax_Details" role="tab" aria-controls="taxDetails" aria-selected="false" style="color:black;">Tax Details</a>
                    </li>
                </ul>
            </div>


            <div class="card-body">
                <div class="tab-content" id="custom-tabs-five-tabContent">
                    <!--Property Details-->
                    <div class="tab-pane fade show active" id="property_Details" role="tabpanel" aria-labelledby="custom-tabs-five-overlay-tab">
                        <form>
                            <div class="card-body">
                                <label style="font-size:25px;">Details of Transfered Property</label>
                                @*FOR SAVING PURPOSE*@
                                <input type="hidden" id="hdnLandOwnershipId" />
                                <input type="hidden" id="hdnLandDetailId" />
                                <input type="hidden" id="hdnLapId" />
                                <input type="hidden" id="hdnDemkhongId" />
                                <input type="hidden" id="hdnPropertyTypeId" />
                                <input type="hidden" id="hdnLandUseSubCategoryId" />
                                <input type="hidden" id="hdnPlotNo" />
                                <input type="hidden" id="hdnLandAcerage" />
                                <input type="hidden" id="hdnLandValue" />
                                <input type="hidden" id="hdnLandPoolingRate" />
                                <input type="hidden" id="hdnStructureAvailable" />
                                <input type="hidden" id="hdnVacantLandTaxApplicable" />
                                <input type="hidden" id="hdnGarbageApplicable" />
                                <input type="hidden" id="hdnStreetLightApplicable" />
                                <input type="hidden" id="hdnIsSubdivided" />
                                <input type="hidden" id="hdnThramNo" />
                                <input type="hidden" id="hdnCID" />
                                <input type="hidden" id="hdnTTIN" />
                                <input type="hidden" id="hdnPLr" />
                                <input type="hidden" id="hdnLandOwnershipType" />
                                @*<input type="hidden" id="hdnIsSubdivided" />*@


                                @*FOR SAVING PURPOSE END*@
                                <div class="row">
                                    <div class="col-4">
                                        <label style="font-size:20px;">Land Details</label>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Plot No</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dPlotNo" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Thram No</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dThramNo" readonly class="form-control" />
                                            </div>
                                        </div>

                                        @*<div class="row">
                <div class="col-4">
                    &nbsp;&nbsp;&nbsp;&nbsp;<label>CID No</label>
                </div>
                <div class="col-8">
                    <input id="downerCID" readonly class="form-control" />
                </div>
                                        *@
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Sub Precinct</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dLusc" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Ownership Type</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dOwnershipType" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Plot Area</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dArea" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Demkhong Name</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dDemkhong" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                &nbsp;&nbsp;&nbsp;&nbsp;<label>Lap Name</label>
                                            </div>
                                            <div class="col-8">
                                                <input id="dLapName" readonly class="form-control" />
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-8">
                                        <label style="font-size:20px;">Building Details</label>
                                        <table class="table table-bordered table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Sl.No</th>
                                                    <th>Plinth Area</th>
                                                    <th>No. of Residential Units</th>
                                                    <th>No. of Commercial Units</th>
                                                    <th>No. of Institutional Units</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1</td>
                                                    <td>Thimphu</td>
                                                    <td>3</td>
                                                    <td>6</td>
                                                    <td>8</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!--Transferor Details-->
                    <div class="tab-pane fade" id="Transferor" role="tabpanel" aria-labelledby="transferor">
                        <div class="form-group row">
                            <table id="tblransferor" class="table table-bordered table-striped">
                                <thead style="background-color:mediumaquamarine">
                                    <tr>
                                        <th>Owner CID</th>
                                        <th>Owner Name</th>
                                        <th>Plot No</th>
                                        <th>Thromde</th>
                                        <th>Thromde Village</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="tranferrorDetail">
                                </tbody>
                            </table>
                        </div>

                    </div>

                    <!--Transferee Details-->
                    <div class="tab-pane fade" id="transferee" role="tabpanel" aria-labelledby="Transferee">
                        <div class="form-group row">
                            <table id="tblransferee" class="table table-bordered table-striped">
                                <thead style="background-color:mediumaquamarine">
                                    <tr>
                                        <th>Owner CID</th>
                                        <th>Owner Name</th>
                                        <th>Plot No</th>
                                        <th>Thromde</th>
                                        <th>Thromde Village</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="tranfereeDetail">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!--Other Details-->
                    <!--<div class="tab-pane fade" id="Other_Details" role="tabpanel" aria-labelledby="Other_Details">
                        <form>
                            <div class="card-body">
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>LAP</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="LapId" class="form-control select2" style="width: 100%;"
                                                value="0">-->
                                            @*<option value="0">--Please select--</option>*@
                                        <!--</select>
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Demkhong</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="DemkhongId" class="form-control select2" style="width: 100%;"
                                                value="0">
                                            <option value="0">--Please select--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Precinct</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="PricintId" class="form-control select2" style="width: 100%;"
                                                value="0">
                                            <option value="0">--Please select--</option>
                                        </select>
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Sub Precinct</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="SubPricintId" class="form-control select2" style="width: 100%;"
                                                value="0">
                                            <option value="0">--Please select--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Street Name</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="StreetNameId" class="form-control select2" style="width: 100%;"
                                                value="0">
                                            <option value="0">--Please select--</option>
                                        </select>
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Land Type</label>
                                    </div>
                                    <div class="col-3">
                                        <select id="LandTypeId" class="form-control select2" style="width: 100%;"
                                                value="0">
                                            <option value="0">--Please select--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Ownership %</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="dOwnershipPercentage" class="form-control" />
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Land Pooling %</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="dLandPoolPercentage" class="form-control" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Garbage Tax Available</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="gtAvailable" class="form-control" />
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Stree Light Available</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="dslAvailable" class="form-control" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Garbage Tax Available</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="gtAvailable" class="form-control" />
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Stree Light Available</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="dslAvailable" class="form-control" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Plot Address</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="PlotAddress" class="form-control" />
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Plot Location</label>
                                    </div>
                                    <div class="col-3">
                                        <input id="PlotLocation" class="form-control" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Vacant Tax Applicable</label>
                                    </div>
                                    <div class="col-3">
                                        <div class="custom-control custom-checkbox">
                                            &nbsp;&nbsp; <input id="VacantLandTax" class="custom-control-input" type="checkbox" checked>
                                            <label for="VacantLandTax" class="custom-control-label">-->
                                                @*  @Html.DisplayNameFor(model => model.IsActive)*@
                                            <!--</label>
                                        </div>
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label>Street Light Applicable</label>
                                    </div>
                                    <div class="col-3">
                                        <div class="custom-control custom-checkbox">
                                            &nbsp;&nbsp; <input id="StreetLight" class="custom-control-input" type="checkbox" checked>
                                            <label for="StreetLight" class="custom-control-label">-->
                                                @*  @Html.DisplayNameFor(model => model.IsActive)*@
                                            <!--</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label>Structure Available</label>
                                    </div>
                                    <div class="col-3">
                                        <div class="custom-control custom-checkbox">
                                            &nbsp;&nbsp; <input id="StructureAvailable" class="custom-control-input" type="checkbox" checked>
                                            <label for="StructureAvailable" class="custom-control-label">-->
                                                @*  @Html.DisplayNameFor(model => model.IsActive)*@
                                            <!--</label>
                                        </div>
                                    </div>
                                    <div class="col-1">
                                    </div>
                                    <div class="col-2">
                                        <label></label>
                                    </div>
                                    <div class="col-3">-->
                                        @* <input id="PlotLocation" class="form-control" />*@
                                    <!--</div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-2">
                                        <label></label>
                                    </div>
                                    <div class="col-3">

                                    </div>
                                    <div class="col-1">
                                        <input id="btnSaveOthersNext" type="button" class="btn btn-primary" value="Save & Next" />-->
                                        @*onclick="return saveMe();"*@
                                        <!--&nbsp;&nbsp;&nbsp;&nbsp;

                                    </div>
                                    <div class="col-2">
                                        <button type="button" class="btn btn-danger" onclick="return CancelSave();">Cancel</button>
                                    </div>
                                    <div class="col-3">

                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>-->

                    <!--Tax Details-->
                    <div class="tab-pane fade" id="Tax_Details" role="tabpanel" aria-labelledby="taxDetails">
                        <form>
                            <div class="card-body">
                                <label style="font-size:25px;">Tax Details</label>
                                <div class="row">
                                    <div class="col-3">
                                        &nbsp;&nbsp;<label>Transfer Fees</label>
                                    </div>
                                    <div class="col-8">
                                        <input id="dTransferFee" readonly class="form-control" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                        &nbsp;&nbsp;<label>Plot Sub-Division Fees</label>
                                    </div>
                                    <div class="col-8">
                                        <input id="dsubdivisionFee" readonly class="form-control" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                        &nbsp;&nbsp;<label>Lag Thram Change</label>
                                    </div>
                                    <div class="col-8">
                                        <input id="dlagthramFee" readonly class="form-control" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                        &nbsp;&nbsp;<label>Total Payable</label>
                                    </div>
                                    <div class="col-8">
                                        <input id="dtotalPayable" readonly class="form-control" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        &nbsp;&nbsp;
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                    </div>
                                    <div class="col-8">
                                        <input id="btnGenerateDemand" type="button" class="btn btn-primary" value="Update" />
                                        &nbsp;&nbsp;&nbsp;&nbsp;
                                        <button type="button" class="btn btn-danger" onclick="return CancelSave();">Cancel</button>
                                    </div>
                                </div>
                                <!--<div class="row">
                                <div class="col-12 d-flex justify-content-end">-->
                                @*<button  class="btn btn-primary" onclick="return saveMe();">Update</button>*@

                                <!--</div>
                                </div>-->
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/plugins/jquery/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    function RegisterTaxPayer() {
        return window.location.href = ("FullPropertyTrasfers/RedirectToTaxPayer");    
    }


    function displayTab() {
        $('#Transactioninput').insertAfter(function () {
            var transactionid = parseInt($('#Transactioninput').val());
            //var transactionid = 1;
            if (transactionid > 0) {
                $('#FPT_details').show(1000);
            }
        });
    }

    //function saveMe() {
    //    swal.fire({
    //        text: "The Transferee is not Registered as Tax Payer with Thimphu Thromde. Would you like to Register the Tax Payer?",
    //        type: "warning",
    //        showCancelButton: true,
    //        confirmButtonClass: "btn-danger",
    //        confirmButtonText: "Yes",
    //        cancelButtonText: "No",
    //        closeOnConfirm: false,
    //        closeOnCancel: false
    //    });
    //}

    function fetchPropertyDetails() {
        $('#img').show();

        SelectListLap();
        $.ajax({
                type: "GET",
                url: '@Url.Action("GetTransactionDetailFromAPIByTransactionId", "FullPropertyTrasfers")',
            data: {
                transactionId: parseInt($('#Transactioninput').val())
                },
                success: function (data) {

                    console.log(data);
                    //return false;
                    $('#tranferrorDetail').empty();
                    $('#tranfereeDetail').empty();

                    //Changed from == 0 to >0
                    if (data.length > 0) {
                        $('#img').hide();
                        $('#FPT_details').show(1000);
                        //PLOT DETAILS
                        //alert(data[0].ownerCID)

                        var ownerCID = data[0].ownerCID;
                        $('#hdnCID').val(ownerCID);

                        var TransactionType = data[0].transactionType;
                        var Ownership = data[0].ownershipType;
                        var thramno = data[0].thram;
                        var plotID = data[0].plotID;
                        var plotArea = data[0].plotArea;
                        var thromde = data[0].thromde;
                        var thromdeVillage = data[0].thromdeVillage;

                        //                //TAX DETAILS
                        var subdivisionFee = 0; var demarcationFee = 0; var lagthramFee = 0; var totalPayable = 0;
                        if (data[0].subdivisionFee != "") {
                            subdivisionFee = data[0].subdivisionFee;
                        }
                        else {
                            subdivisionFee = 0;
                        }
                        if (data[0].demarcationFee != "") {
                            demarcationFee = data[0].demarcationFee;
                        }
                        else {
                            demarcationFee = 0;
                        }
                        if (data[0].lagthramFee != "") {
                            lagthramFee = data[0].lagthramFee;
                        }
                        else {
                            lagthramFee = 0;
                        }
                        if (data[0].totalPayable != "") {
                            totalPayable = data[0].totalPayable;
                        }
                        else {
                            totalPayable = 0;
                        }
                        //var landValue = data[0].landValue;
                        //var buildingValue = data[0].buildingValue;

                        $('#hdnTransactionId').val(parseInt($('#Transactioninput').val()));

                        $('#dTransactionType').val(TransactionType);
                        $('#dOwnership').val(Ownership);
                        $('#dThramNo').val(thramno);
                        $('#dPlotNo').val(plotID);
                        $('#dArea').val(plotArea);
                        $('#dThromdeName').val(thromde);
                        $('#dThromdeVillage').val(thromdeVillage);


                    $('#dsubdivisionFee').val(subdivisionFee);
                    $('#ddemarcationFee').val(demarcationFee);
                    $('#dlagthramFee').val(lagthramFee);
                    $('#dtotalPayable').val(totalPayable);
                    //$('#dlandValue').val(landValue);
                    //$('#dbuildingValue').val(buildingValue);



                         //transferror
                        var transferrorResult = null; var transfereeResult = null
                        $.each(data, function (key, value) {
                            
                            transferrorResult = (value.LandOwnershipId > 0) ? '' : '<b><a onclick="return RegisterTaxPayer();" style="cursor: pointer; color: forestgreen;" title="Register Tax Payer">Register</a></b>'
                            $('#tranferrorDetail').append(
                                '<tr>'
                               // + '<td style=display:none>' +  + '</td>'
                                + '<td><input type="hidden" id="hdnTransferrorTpid_' + key + '" value="' + value.taxPayerId + '" />' + value.ownerCID + '</td>'                              
                                + '<td>' + value.ownerName + '</td>'  
                                + '<td>' + value.plotID + '</td>'
                                + '<td>' + value.thromde + '</td>'                             
                                + '<td>' + value.thromdeVillage + '</td>'
                                + '<td>' + transferrorResult+' </td>'                               
                                + '</tr>');
                        });
                        //transferee
                        $.each(data, function (key, value) {
                            transfereeResult = (value.LandOwnershipId > 0) ? '' : '<b><a onclick="return RegisterTaxPayer();" style="cursor: pointer; color: forestgreen;" title="Register Tax Payer">Register</a></b>'

                            $('#tranfereeDetail').append(
                                '<tr>'
                                + '<td><input type="hidden" id="hdnTransfereeTpid_' + key + '" value="' + value.taxPayerId + '" />' + value.ownerCID + '</td>'                               
                                + '<td>' + value.ownerName + '</td>'
                                + '<td>' + value.plotID + '</td>'
                                + '<td>' + value.thromde + '</td>'
                                + '<td>' + value.thromdeVillage + '</td>'
                                + '<td>' + transfereeResult + ' </td>'  
                                + '</tr>');
                        });
                        //Thromde plot details
                        /* function SelectListLap() {*/
                                $.ajax({
                                        type: "Get",
                                        url: '@Url.Action("GetTransferorProperty", "FullPropertyTrasfers")',
                                        data: {
                                            PlotNo: plotID,
                                            Cid: ownerCID
                                        },
                                        success: function (data) {
                                                    console.log(data);

                                                    if (data.length > 0) {
                                                                            //PLOT DETAILS DISPLAY
                                                                          //  $('#LapId').empty();
                                                                           $('#hdnLandOwnershipId').val(data[0].landOwnershipId);
                                                                            $('#hdnLandDetailId').val(data[0].landDetailId);
                                                                            $('#hdnLapId').val(data[0].lapId);
                                                                            $('#hdnDemkhongId').val(data[0].demkhongId);
                                                                            $('#hdnPropertyTypeId').val(data[0].propertyTypeId);
                                                                            $('#hdnLandUseSubCategoryId').val(data[0].landUseSubCategoryId);
                                                                            $('#hdnLandValue').val(data[0].landValue);
                                                                            $('#hdnLandPoolingRate').val(data[0].landPoolingRate);
                                                                            $('#hdnStructureAvailable').val(data[0].structureAvailable);
                                                                            $('#hdnVacantLandTaxApplicable').val(data[0].vacantLandTaxApplicable);
                                                                            $('#hdnGarbageApplicable').val(data[0].garbageApplicable);
                                                                            $('#hdnStreetLightApplicable').val(data[0].streetLightApplicable);
                                                                            $('#hdnIsSubdivided').val(data[0].isSubdivided);
                                                                            $('#hdnLandOwnershipType').val(data[0].landOwnershipTypeId);
                                                                            $('#dPlotNo').val(data[0].plotNo);
                                                                            $('#dThramNo').val(data[0].thramNo);
                                                                            $('#dArea').val(data[0].pLr);
                                                                            $('#dLusc').val(data[0].landUseSubCategory);
                                                                            $('#dOwnershipType').val(data[0].landOwnershipType);
                                                                            $('#dDemkhong').val(data[0].demkhongName);
                                                                            $('#dLapName').val(data[0].lapName);

                                                                         }
                                                                    else {
                                                                        //$('#img').hide();
                                                                          }

                                                            },
                                                            error: function () {
                                                                //$('#img').hide();
                                                                alert('Error occured');
                                                           }
                                       });
                            //}
                    }
                    else {
                        $('#img').hide();
                        //location.reload();
                        alert("No records found.!")
                        $('#FPT_details').hide(1000);
                        $('#tranferrorDetail').append(
                            '<tr><td colspan="3" style="color: red;">No record found!</td></tr>');
                    }

                },
                    error: function () {
                        $('#img').hide();
                        $('#FPT_details').hide(1000);
                    alert('Error occured');
                    }
        });
        //$('#lblassetdetail').html(assetname);
    }

    function CancelSave() {
        $('#FPT_details').hide(1000);
    }
    function SelectListLap() {
        $.ajax({
                type: "POST",
                url: '@Url.Action("SelectListLap", "FullPropertyTrasfers")',
                data: {
                    //AssetAttributeId: parseInt(assetattribute_id)
                },
                success: function (data) {

                    console.log(data);
                    $('#LapId').empty();
                   // $('#LapId').append('<option value=0>--Please Select--</option>');

                    if (data.length > 0) {

                    for (var i = 0; i < data.length; i++) {
                        var newOption = $('<option value=' + data[i].value + '> '
                            + data[i].text
                        + ' </option>');
                        $('#LapId').append(newOption);
                    }
                }
                else {
                    //$('#img').hide();
                }

                },
                error: function () {
                    //$('#img').hide();
                    alert('Error occured');
                }
                });

    }
    $("#btnGenerateDemand").click(function () {

        var selectedTransfereeIds = new Array();
        var j = 0; var str_transfereeTpids = '';

        $("#tblransferee TBODY TR").each(function () {

            selectedTransfereeIds.push($('#hdnTransfereeTpid_' + j).val());            
        });
        if (selectedTransfereeIds.length > 0) {
            str_transfereeTpids = selectedTransfereeIds.join(",");            
        }
       // alert(str_transfereeTpids);
        
        var myarray = [];
        var i = 0;        

        $("#tblransferor TBODY TR").each(function () {
            var transferorobj = {};
            var transferorid = parseInt($('#hdnTransferrorTpid_' + i).val());
            transferorobj.landDetailId = parseInt($('#hdnLandDetailId').val());
            transferorobj.transferorid = transferorid;
            transferorobj.transfereeTpids = str_transfereeTpids;

            transferorobj.SubdivisionFee = parseFloat($('#dsubdivisionFee').val());
            //transferorobj.LagthramFee = parseFloat($("#dlagthramFee").val());
            //transferorobj.PlotNo = ($("#dPlotNo").val());
          
            transferorobj.LandOwnershipId = parseInt($("#hdnLandOwnershipId").val());

            myarray.push(transferorobj)
            i++;

        });               

        var json_data = JSON.stringify(myarray);
        console.log(json_data);

        return false;

        var myarray = [];
        var DemandVM = {};
        DemandVM.SubdivisionFee = parseFloat($('#dsubdivisionFee').val());
        DemandVM.LagthramFee = parseFloat($("#dlagthramFee").val());
        DemandVM.PlotNo = ($("#dPlotNo").val());
        DemandVM.Cid = ($("#hdnCID").val());
        DemandVM.LandOwnershipId = parseInt($("#hdnLandOwnershipId").val());
        DemandVM.taxPayerId = parseInt($("#hdnLandOwnershipId").val());
       // DemandVM.landOwnershipId = parseInt($("#hdnlandOwnershipId").val());
        myarray.push(DemandVM);
        var json_data = JSON.stringify(myarray);
        console.log(json_data);

    //    swal({
    //        title: "Ful Property Transfer",
    //        text: "The Transferee is not Registered as Tax Payer with Thimphu Thromde. Would you like to Register the Tax Payer?",
    //        confirmButtonText: "Yes, Save it!",
    //        cancelButtonText: "No, cancel!",
    //        type: "info",
    //        showCancelButton: true,
    //        closeOnConfirm: false,
    //        showLoaderOnConfirm: true,
    //    },
    //        function () {
    //            setTimeout(function () {
    //                //

    //                            swal.fire("Ajax request finished!");


    //    }, 2000);
    //});
    $('#img').show();
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("CreateDemand", "FullPropertyTrasfers")',
                        data: json_data,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            $('#img').hide();
                            swal(response);
                        },
                        failure: function (response) {
                            $('#img').hide();
                            swal("Saving Failed.!");
                        },
                        error: function (response) {
                            $('#img').hide();
                            swal("Error while inserting.!");
                        }
                    });

    });
   ////ajax api fetch no dynamic token
    //function fetchPropertyDetails() {
    //    var trnid = "";
    //    //  alert($('#Transactioninput').val());
    //    if ($('#Transactioninput').val() == "") {
    //        swal('Please enter Transaction ID');
    //        return false;
    //    }
    //    else {
    //        trnid = parseInt($('#Transactioninput').val());
    //    }
    //    //alert(empno);
    //    var token = "812c2d79-36f4-3610-937c-6363d8e18b2d";
    //    $('#img').show();
    //    //Send the JSON array to API using AJAX.
    //    $.ajax({
    //        type: "GET",
    //        url: 'https://stg-api.dit.gov.bt/nlcs_landdetailapi/1.0.0/transactiondetails/' + trnid,
    //        //data: json_array,
    //        error: function (e) {
    //            $('#img').hide();
    //            console.log(e);
    //        },
    //        dataType: "json",
    //        contentType: "application/json; charset=utf-8",
    //        crossDomain: true,
    //        headers: {
    //            Authorization: 'Bearer ' + token
    //        },
    //        success: function (r) {
    //            console.log(r);

    //            if (r != "") {
    //                $('#FPT_details').show(1000);

    //                $('#img').hide();
    //                //swal("Data fetched successfully.");
    //                //return false;

    //                //PLOT DETAILS
    //                var thramno = r.transactions.transaction[0].thram;
    //                var plotID = r.transactions.transaction[0].plotID;
    //                var plotArea = r.transactions.transaction[0].plotArea;
    //                var thromde = r.transactions.transaction[0].thromde;
    //                var thromdeVillage = r.transactions.transaction[0].thromdeVillage;

    //                $('#dThramNo').val(thramno);
    //                $('#dPlotNo').val(plotID);
    //                $('#dArea').val(plotArea);
    //                $('#dThromdeName').val(thromde);
    //                $('#dThromdeVillage').val(thromdeVillage);


    //                //Transferer DETAILS




    //                //Transferee DETAILS


    //                //TAX DETAILS
    //                var subdivisionFee = r.transactions.transaction[0].subdivisionFee;
    //                var demarcationFee = r.transactions.transaction[0].demarcationFee;
    //                var lagthramFee = r.transactions.transaction[0].lagthramFee;
    //                var totalPayable = r.transactions.transaction[0].totalPayable;
    //                var landValue = r.transactions.transaction[0].landValue;
    //                var buildingValue = r.transactions.transaction[0].buildingValue;


    //                $('#dsubdivisionFee').val(subdivisionFee);
    //                $('#ddemarcationFee').val(demarcationFee);
    //                $('#dlagthramFee').val(lagthramFee);
    //                $('#dtotalPayable').val(totalPayable);
    //                //$('#dlandValue').val(landValue);
    //                //$('#dbuildingValue').val(buildingValue);
    //            }
    //            else {
    //                //$('#img').hide();
    //                swal("Error. No record found!");
    //            }
    //        }
    //    });

    //}

</script>