@using CORE_BOL
@model AssetRegisterVM

@{
    ViewData["Title"] = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var secid = Model.SectionId;

}

<input type="hidden" value="@secid" id="hndsecid" />

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark"></h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-action="Index">Asset Register</a></li>
                    <li class="breadcrumb-item active">Update Asset Detail Detail</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<div class="card card-info">
    @if (TempData["msg"] != null)
    {
        <div class="alert alert-danger alert-dismissible">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            <h5><i class="icon fas fa-ban"></i> Alert!</h5>
            <p>@TempData["msg"]</p>
        </div>
    }
    <div class="card-header">
        <h3 class="card-title">Update Asset Register Detail</h3>
    </div>
    <!-- /.card-header -->
    <!-- form start -->
    <form class="form-horizontal" asp-action="Edit" method="post">
        @*data-ajax="true" data-ajax-method="post">*@
        <div class="card-body">
            <p>
                <a asp-action="Index" class="btn btn-outline-danger btn-lg" title="Go Back"><i class="fas fa-backward"></i> Go Back</a>
            </p>
            <input type="hidden" asp-for="AssetId" id="hdnassetId" />
            <input type="hidden" asp-for="DivisionId" id="hnddid" />
            <input type="hidden" asp-for="PrimaryAccountHeadId" id="hndpriid" />
            <input type="hidden" asp-for="SecondaryAccountHeadId" id="hndsed" />
            <input type="hidden" asp-for="TertiaryAccountHeadId" id="hndter" />
            <input type="hidden" asp-for="ZoneId" id="hdnzid" />
            <input type="hidden" asp-for="AreaId" id="hdnaid" />
            <input type="hidden" asp-for="GoodReceiveBy" id="hdngrb" />
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group row">

                <label class="col-sm-2 col-form-label"> Asset Code</label>
                <div class="col-sm-4">
                    <input id="assetnumber" class="form-control" disabled />

                </div>
            </div>
            <div class="form-group row">
                <label asp-for="DivisionId" class="col-sm-2 col-form-label">Division<span style="font-weight: bold; color: red;">*</span></label>
                <div class="col-sm-4">
                    <select class="form-control select2" id="DivisionId" style="width: 100%;"
                            asp-items="@(new SelectList (@ViewBag.DivisionId,"Value","Text")) " value="0">
                        <option value="0">--Please select--</option>
                    </select>

                </div>

                <label asp-for="SectionId" class="col-sm-2 col-form-label">Section<span style="font-weight: bold; color: red;">*</span></label>
                <div class="col-sm-4">
                    <select asp-for="SectionId" class="form-control select2" id="sec" style="width: 100%;"
                            value="0">
                        <option value="0">--Please select--</option>
                    </select>
                    <span asp-validation-for="SectionId" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="PrimaryAccountHeadId" class="col-sm-2 col-form-label">Primary Account Head<span style="font-weight: bold; color: red;">*</span></label>
                <div class="col-sm-4">
                    <select class="form-control select2" id="pri" style="width: 100%;"
                            asp-items="@(new SelectList (@ViewBag.PrimaryAccountHeadId,"Value","Text")) " value="0">
                        <option value="0">--Please select--</option>
                    </select>

                </div>
                <label asp-for="SecondaryAccountHeadId" class="col-sm-2 col-form-label">Secondary Account Head ID<span style="font-weight: bold; color: red;">*</span></label>
                <div class="col-sm-4">
                    <select asp-for="SecondaryAccountHeadId" class="form-control select2" style="width: 100%;"
                            value="0">
                        <option value="0">--Please select--</option>
                    </select>
                    <span asp-validation-for="SecondaryAccountHeadId" class="text-danger"></span>
                </div>

            </div>
            <div class="form-group row">
                <label asp-for="TertiaryAccountHeadId" class="col-sm-2 col-form-label">Tertiary Account Head ID<span style="font-weight: bold; color: red;">*</span></label>
                <div class="col-sm-4">
                    <select asp-for="TertiaryAccountHeadId" class="form-control select2" style="width: 100%;"
                            value="0">
                        <option value="0">--Please select--</option>
                    </select>
                    <span asp-validation-for="TertiaryAccountHeadId" class="text-danger"></span>
                </div>
                <label asp-for="AssetStatusId" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <select asp-for="AssetStatusId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.AssetStatusId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="AssetStatusId" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="AssetFunctionId" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <select asp-for="AssetFunctionId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.AssetFunctionId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="AssetFunctionId" class="text-danger"></span>
                </div>
                <label asp-for="SupplierId" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <select asp-for="SupplierId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.SupplierId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="SupplierId" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="LapId" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <select asp-for="LapId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.LapId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="LapId" class="text-danger"></span>
                </div>
                <label asp-for="DemkhongId" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <select asp-for="DemkhongId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.DemkhongId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="DemkhongId" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">

                <label class="col-sm-2 col-form-label">Area</label>
                <div class="col-sm-4">
                    <select asp-for="AreaId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.AreaId,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="AreaId" class="text-danger"></span>
                </div>
                <label class="col-sm-2 col-form-label">Zone</label>
                <div class="col-sm-4">
                    <select asp-for="ZoneId" class="form-control select2bs4" style="width: 100%;" asp-items="@(new SelectList (@ViewBag.Zone,"Value","Text")) " value="0"></select>
                    <span asp-validation-for="DemkhongId" class="text-danger"></span>
                </div>

            </div>
            <div class="form-group row">

                <label asp-for="AssetCode" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="AssetCode" class="form-control" placeholder="Enter Asset Code" />
                    <span asp-validation-for="AssetCode" class="text-danger"></span>
                </div>
                <label asp-for="AssetName" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="AssetName" class="form-control" placeholder="Enter Asset name" />
                    <span asp-validation-for="AssetName" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="ResponsiblePerson" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="ResponsiblePerson" class="form-control" placeholder="Responsible Person" />
                    <span asp-validation-for="ResponsiblePerson" class="text-danger"></span>
                </div>
                <label class="col-sm-2 col-form-label">Received/Completion/Commission By</label>
                <div class="col-sm-4">
                    <select asp-for="GoodReceiveBy" id="grt" class="form-control select2bs4" style="width: 100%;" value="0"></select>
                    <span asp-validation-for="GoodReceiveBy" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="GoodReceiveDate" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="GoodReceiveDate" type="date" class="form-control" placeholder="Goods Received Date" />
                    <span asp-validation-for="GoodReceiveDate" class="text-danger"></span>
                </div>
                <label asp-for="GisCode" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="GisCode" class="form-control" placeholder="GIS Code" />
                    <span asp-validation-for="GisCode" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">


                <label asp-for="Remarks" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="Remarks" class="form-control" placeholder="Remarks" />
                    <span asp-validation-for="Remarks" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="IsActive" class="col-sm-2 col-form-label"></label>
                <div class="custom-control custom-checkbox col-sm-4">
                    &nbsp;&nbsp;<input class="custom-control-input" type="checkbox" asp-for="IsActive" checked>
                    <label for="IsActive" class="custom-control-label">
                        @Html.DisplayNameFor(model => model.IsActive)
                    </label>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label"></label>
                <div class="col-sm-10">
                    <button type="submit" class="btn btn-primary" onclick="return saveme();">Save</button>
                    <button type="reset" id="btnCancel" class="btn btn-warning">Cancel</button>
                </div>
            </div>
        </div>
            <!-- /.card-body -->

</form>
</div>
<script src="~/plugins/jquery/jquery.min.js"></script>
<script>

    //Auto populate division
    $(function () {
        $('#DivisionId').val($('#hnddid').val());
       // $('#grt').val($('#hdngrb').val());
    @*//Auto populate area
        $.ajax({
                type: "POST",
                url: '@Url.Action("FetchArea", "Assets")',
                data: {
                    aid: parseInt($('#hdnaid').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#AreaId').empty();
                    $('#AreaId').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].areaId + '>'
                                + data[i].areaName
                                + '</option>');
                            $('#AreaId').append(newOption);
                        }


                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });
         //Auto populate zone
        $.ajax({
                type: "POST",
                url: '@Url.Action("FetchZone", "Assets")',
                data: {
                    zid: parseInt($('#hdnzid').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#ZoneId').empty();
                    $('#ZoneId').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].zoneId + '>'
                                + data[i].zoneName
                                + '</option>');
                            $('#ZoneId').append(newOption);
                        }


                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });*@

        //Auto populate user-->
        $.ajax({
                type: "POST",
                url: '@Url.Action("Fetchuser", "Assets")',
                data: {
                   // uid: parseInt($('#hdngrb').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#grt').empty();
                    $('#grt').append(
                        '<option value=0>--Please Select one--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].userId + '>'
                                + data[i].userName
                                + '</option>');
                            $('#grt').append(newOption);
                        }

                        $('#grt').val($('#hdngrb').val());
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });

       
    //Auto populate section
        $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateSEC", "Assets")',
                data: {
                    id: parseInt($('#hnddid').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#sec').empty();
                    $('#sec').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].sectionId + '>'
                                + data[i].sectionName
                                + '</option>');
                            $('#sec').append(newOption);
                        }

                        $('#sec').val($('#hndsecid').val());
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });

        //Auto populate primary
        $('#pri').val($('#hndpriid').val());


        //Auto populate secondary
        $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateSED", "Assets")',
                data: {
                    id: parseInt($('#hndpriid').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#SecondaryAccountHeadId').empty();
                    $('#SecondaryAccountHeadId').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].secondaryAccountHeadId + '>'
                                + data[i].secondaryAccountHeadName
                                + '</option>');
                            $('#SecondaryAccountHeadId').append(newOption);
                        }

                        $('#SecondaryAccountHeadId').val($('#hndsed').val());
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });

        //Auto populate for tertiary
        $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateTER", "Assets")',
                data: {
                    id: parseInt($('#hndsed').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#TertiaryAccountHeadId').empty();
                    $('#TertiaryAccountHeadId').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].tertiaryAccountHeadId + '>'
                                + data[i].tertiaryAccountHeadName
                                + '</option>');
                            $('#TertiaryAccountHeadId').append(newOption);
                        }

                        $('#TertiaryAccountHeadId').val($('#hndter').val());
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });



        //Auto populate section
        $.ajax({
                type: "POST",
                url: '@Url.Action("GetAssetsNumber", "Assets")',
                data: {
                    AssetId: parseInt($('#hdnassetId').val())
                },

                success: function (data) {
                    console.log(data);
                  //  $('#assetnumber').empty();
                  //
                    if (data.length > 0) {
                        var asset = data[0].assetCode;
                        $("#assetnumber").val(asset);

                    }

                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
        });


    });


    //For Section
    $(function () {
        $('#DivisionId').change(function () {


            $('#img').show();

            $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateSEC", "Assets")',
                data: {
                    id: parseInt($('#DivisionId').val())
                },
                success: function (data) {

                    console.log(data);
                    $('#sec').empty();

                    $('#sec').append(
                        '<option value=0>--Please Select--</option>');

                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].sectionId + '>'
                                + data[i].sectionName
                                + '</option>');
                            $('#sec').append(newOption);
                        }

                        $('#img').hide();
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
            });
        });

    });

    //For Secondary
    $(function () {
         $('#pri').change(function () {
            $('#img').show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateSED", "Assets")',
                data: {
                    id: parseInt($('#pri').val())
                },

                success: function (data) {
                    console.log(data);
                    $('#SecondaryAccountHeadId').empty();
                    $('#SecondaryAccountHeadId').append(
                        '<option value=0>--Please Select--</option>');
                    $('#TertiaryAccountHeadId').empty();
                    $('#TertiaryAccountHeadId').append(
                        '<option value=0>--Please Select--</option>');
                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].secondaryAccountHeadId + '>'
                                + data[i].secondaryAccountHeadName
                                + '</option>');
                            $('#SecondaryAccountHeadId').append(newOption);
                        }

                        $('#img').hide();
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
            });
        });
    });

    //For Tertiary
    $(function () {
        $('#SecondaryAccountHeadId').change(function () {
            $('#img').show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("PopulateTER", "Assets")',
                data: {
                    id: parseInt($('#SecondaryAccountHeadId').val())
                },
                success: function (data) {

                    console.log(data);
                    $('#TertiaryAccountHeadId').empty();
                    $('#TertiaryAccountHeadId').append(
                        '<option value=0>--Please Select--</option>');

                    if (data.length > 0) {

                        for (var i = 0; i < data.length; i++) {
                            var newOption = $('<option value=' + data[i].tertiaryAccountHeadId + '>'
                                + data[i].tertiaryAccountHeadName
                                + '</option>');
                            $('#TertiaryAccountHeadId').append(newOption);
                        }

                        $('#img').hide();
                    }
                    else {
                        $('#img').hide();
                    }

                },
                error: function () {
                    $('#img').hide();
                    alert('Error occured');
                }
            });
        });
    });

    function saveme() {
        $('#img').show();
    }
</script>
